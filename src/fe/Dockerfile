FROM node:16.15.1 as builder

WORKDIR /app

# install dependencies
COPY package*.json .
RUN npm install

# build app
ARG VUE_APP_API_DATA_URL
ARG VUE_APP_API_PUBLICDATA_URL
ARG VUE_APP_API_DOCUMENT_URL
ARG VUE_APP_MSAL_CLIENT_ID
ARG VUE_APP_MSAL_AUTHORITY
ARG VUE_APP_MSAL_REDIRECT_URI
ARG VUE_APP_MSAL_POST_LOGOUT_REDIRECT_URI
ARG VUE_APP_MSAL_SCOPES

ENV VUE_APP_API_DATA_URL=${VUE_APP_API_DATA_URL}
ENV VUE_APP_API_PUBLICDATA_URL=${VUE_APP_API_PUBLICDATA_URL}
ENV VUE_APP_API_DOCUMENT_URL=${VUE_APP_API_DOCUMENT_URL}
ENV VUE_APP_MSAL_CLIENT_ID=${VUE_APP_MSAL_CLIENT_ID}
ENV VUE_APP_MSAL_AUTHORITY=${VUE_APP_MSAL_AUTHORITY}
ENV VUE_APP_MSAL_REDIRECT_URI=${VUE_APP_MSAL_REDIRECT_URI}
ENV VUE_APP_MSAL_POST_LOGOUT_REDIRECT_URI=${VUE_APP_MSAL_POST_LOGOUT_REDIRECT_URI}
ENV VUE_APP_MSAL_SCOPES=${VUE_APP_MSAL_SCOPES}

COPY . .
RUN npm run build


FROM nginx:latest
COPY --from=builder /app/dist /usr/share/nginx/html